import java.sql.*;
import java.util.*;

public class JDBCFullDemo {
    static final String URL = "jdbc:mysql://localhost:3306/college_db";
    static final String USER = "root";
    static final String PASS = "root";

    public static Connection getConnection() throws SQLException {
        return DriverManager.getConnection(URL, USER, PASS);
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        int ch;
        do {
            System.out.println("\n===== JDBC APPLICATION MENU =====");
            System.out.println("1. Fetch Employee Data");
            System.out.println("2. Product CRUD Operations");
            System.out.println("3. Student Management System");
            System.out.println("4. Exit");
            System.out.print("Enter choice: ");
            ch = sc.nextInt();
            switch (ch) {
                case 1 -> fetchEmployees();
                case 2 -> productMenu(sc);
                case 3 -> studentMenu(sc);
                case 4 -> System.out.println("Exiting...");
                default -> System.out.println("Invalid choice");
            }
        } while (ch != 4);
        sc.close();
    }

    static void fetchEmployees() {
        try (Connection con = getConnection();
             Statement st = con.createStatement();
             ResultSet rs = st.executeQuery("SELECT * FROM Employee")) {
            while (rs.next())
                System.out.printf("EmpID: %d | Name: %s | Salary: %.2f%n",
                        rs.getInt(1), rs.getString(2), rs.getDouble(3));
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void productMenu(Scanner sc) {
        int c;
        do {
            System.out.println("\n1. Add Product\n2. View Products\n3. Update Price\n4. Delete Product\n5. Back");
            c = sc.nextInt();
            switch (c) {
                case 1 -> addProduct(sc);
                case 2 -> viewProducts();
                case 3 -> updateProduct(sc);
                case 4 -> deleteProduct(sc);
                case 5 -> System.out.println("Returning...");
                default -> System.out.println("Invalid");
            }
        } while (c != 5);
    }

    static void addProduct(Scanner sc) {
        try (Connection con = getConnection()) {
            System.out.print("ID: ");
            int id = sc.nextInt();
            sc.nextLine();
            System.out.print("Name: ");
            String name = sc.nextLine();
            System.out.print("Price: ");
            double price = sc.nextDouble();
            System.out.print("Quantity: ");
            int qty = sc.nextInt();
            PreparedStatement ps = con.prepareStatement("INSERT INTO Product VALUES(?, ?, ?, ?)");
            ps.setInt(1, id);
            ps.setString(2, name);
            ps.setDouble(3, price);
            ps.setInt(4, qty);
            ps.executeUpdate();
            System.out.println("Product Added");
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void viewProducts() {
        try (Connection con = getConnection();
             Statement st = con.createStatement();
             ResultSet rs = st.executeQuery("SELECT * FROM Product")) {
            while (rs.next())
                System.out.printf("ID: %d | Name: %s | Price: %.2f | Qty: %d%n",
                        rs.getInt(1), rs.getString(2), rs.getDouble(3), rs.getInt(4));
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void updateProduct(Scanner sc) {
        try (Connection con = getConnection()) {
            con.setAutoCommit(false);
            System.out.print("Product ID: ");
            int id = sc.nextInt();
            System.out.print("New Price: ");
            double price = sc.nextDouble();
            PreparedStatement ps = con.prepareStatement("UPDATE Product SET Price=? WHERE ProductID=?");
            ps.setDouble(1, price);
            ps.setInt(2, id);
            int r = ps.executeUpdate();
            if (r > 0) {
                con.commit();
                System.out.println("Updated");
            } else {
                con.rollback();
                System.out.println("Not Found");
            }
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void deleteProduct(Scanner sc) {
        try (Connection con = getConnection()) {
            con.setAutoCommit(false);
            System.out.print("Product ID: ");
            int id = sc.nextInt();
            PreparedStatement ps = con.prepareStatement("DELETE FROM Product WHERE ProductID=?");
            ps.setInt(1, id);
            int r = ps.executeUpdate();
            if (r > 0) {
                con.commit();
                System.out.println("Deleted");
            } else {
                con.rollback();
                System.out.println("Not Found");
            }
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void studentMenu(Scanner sc) {
        int c;
        do {
            System.out.println("\n1. Add Student\n2. View Students\n3. Update Marks\n4. Delete Student\n5. Back");
            c = sc.nextInt();
            switch (c) {
                case 1 -> addStudent(sc);
                case 2 -> viewStudents();
                case 3 -> updateStudent(sc);
                case 4 -> deleteStudent(sc);
                case 5 -> System.out.println("Returning...");
                default -> System.out.println("Invalid");
            }
        } while (c != 5);
    }

    static void addStudent(Scanner sc) {
        try (Connection con = getConnection()) {
            System.out.print("ID: ");
            int id = sc.nextInt();
            sc.nextLine();
            System.out.print("Name: ");
            String name = sc.nextLine();
            System.out.print("Department: ");
            String dept = sc.nextLine();
            System.out.print("Marks: ");
            double marks = sc.nextDouble();
            PreparedStatement ps = con.prepareStatement("INSERT INTO Student VALUES(?, ?, ?, ?)");
            ps.setInt(1, id);
            ps.setString(2, name);
            ps.setString(3, dept);
            ps.setDouble(4, marks);
            ps.executeUpdate();
            System.out.println("Student Added");
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void viewStudents() {
        try (Connection con = getConnection();
             Statement st = con.createStatement();
             ResultSet rs = st.executeQuery("SELECT * FROM Student")) {
            while (rs.next())
                System.out.printf("ID: %d | Name: %s | Dept: %s | Marks: %.2f%n",
                        rs.getInt(1), rs.getString(2), rs.getString(3), rs.getDouble(4));
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void updateStudent(Scanner sc) {
        try (Connection con = getConnection()) {
            System.out.print("Student ID: ");
            int id = sc.nextInt();
            System.out.print("New Marks: ");
            double marks = sc.nextDouble();
            PreparedStatement ps = con.prepareStatement("UPDATE Student SET Marks=? WHERE StudentID=?");
            ps.setDouble(1, marks);
            ps.setInt(2, id);
            int r = ps.executeUpdate();
            System.out.println(r > 0 ? "Updated" : "Not Found");
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }

    static void deleteStudent(Scanner sc) {
        try (Connection con = getConnection()) {
            System.out.print("Student ID: ");
            int id = sc.nextInt();
            PreparedStatement ps = con.prepareStatement("DELETE FROM Student WHERE StudentID=?");
            ps.setInt(1, id);
            int r = ps.executeUpdate();
            System.out.println(r > 0 ? "Deleted" : "Not Found");
        } catch (SQLException e) {
            System.out.println(e.getMessage());
        }
    }
}
